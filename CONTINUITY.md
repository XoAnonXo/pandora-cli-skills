Goal (incl. success criteria):
- Keep `pandora mirror` production-grade and operator-safe for Polymarket -> Pandora pAMM delta-neutral sync.
- Success criteria:
  - New command family works end-to-end: `mirror plan`, `mirror deploy`, `mirror sync run|once`, `mirror status`, `mirror verify`.
  - Liquidity sizing formula matches locked model+depth-cap specification.
  - Sync loop is paper-first, supports live execution with strict gates and deterministic blocking errors.
  - Rules/similarity verification is explicit and consumable by AI subagents.
  - Existing commands remain backward-compatible and tests pass.
  - Mirror sync exposes explicit hedge controls for runtime tuning (requested).

Constraints/Assumptions:
- Follow AGENTS.md continuity process every turn.
- Additive-only changes to existing CLI behavior (no breaking changes).
- Source venue for mirror v1 is Polymarket only.
- Mirror deploy target is Pandora AMM only in v1.
- Foreground loop runtime only (no daemon manager).

Key decisions:
- Implement user-approved decision-complete mirror plan across M1-M4 in this patch.
- Default execution posture is paper mode; live mode requires explicit opt-in and full guard flags.
- Delta-neutral target is LP inventory neutral using reserve imbalance proxy.
- Strict gating enforces match confidence, exact rule-hash presence/match (unless override), lifecycle, close-time drift, depth, and risk caps.

State:
  - Done:
    - Added mirror services:
      - `/Users/mac/Desktop/pandora-market-setup-shareable/cli/lib/mirror_service.cjs`
      - `/Users/mac/Desktop/pandora-market-setup-shareable/cli/lib/mirror_sizing_service.cjs`
      - `/Users/mac/Desktop/pandora-market-setup-shareable/cli/lib/mirror_verify_service.cjs`
      - `/Users/mac/Desktop/pandora-market-setup-shareable/cli/lib/mirror_sync_service.cjs`
      - `/Users/mac/Desktop/pandora-market-setup-shareable/cli/lib/mirror_state_store.cjs`
      - `/Users/mac/Desktop/pandora-market-setup-shareable/cli/lib/polymarket_trade_adapter.cjs`
      - `/Users/mac/Desktop/pandora-market-setup-shareable/cli/lib/pandora_deploy_service.cjs`
    - Wired `mirror` command family into CLI:
      - `mirror plan`, `mirror deploy`, `mirror verify`, `mirror sync run|once`, `mirror status`
      - Help, parsing, renderers, strict flag validation, JSON envelopes.
    - Added deterministic tests:
      - Unit mirror sizing/rules/state/depth coverage.
      - CLI mirror command integration coverage.
      - Smoke help checks for mirror commands.
    - Critical review fixes applied:
      - `RULE_HASH_MATCH` now fails strict gate when one side is missing rule text.
      - `mirror status --state-file` no longer overwrites/misreports stored strategy hash.
      - `--strategy-hash` validation added (`16` hex chars).
    - Docs updated in `README_FOR_SHARING.md` and `SKILL.md` with mirror command/contracts.
    - Validation passed:
      - `npm run build`
      - `npm run test:unit`
      - `npm run test:cli`
      - `npm run test:smoke`
      - `npm run test`
      - `npm run pack:dry-run`
    - Revalidated on 2026-02-26 with full suite:
      - `npm run test` (build + unit + cli + smoke) passed.
    - Committed and pushed to `main`:
      - commit: `dacce9e`
      - branch push: `origin/main` updated (`355912a..dacce9e`).
    - Latest remote state:
      - `main` is clean and synchronized with `origin/main`.
    - NPM registry check on 2026-02-26:
      - package `pandora-cli-skills` latest published version is `1.1.3`.
      - published versions are `1.0.2`, `1.0.3`, `1.1.2`, `1.1.3`.
    - Release on 2026-02-26:
      - bumped version `1.1.3 -> 1.1.4`.
      - full validation passed via `npm run test`.
      - published `pandora-cli-skills@1.1.4` with `dist-tag latest=1.1.4`.
    - Mirror hedge controls (2026-02-26):
      - added `mirror sync` flags: `--hedge-ratio <n>` (default `1`, max `2`) and `--no-hedge`.
      - added snapshot diagnostics: `rawHedgeTriggered`, `hedgeSuppressed`, and parameter echo (`hedgeEnabled`, `hedgeRatio`).
      - added CLI integration tests for hedge-ratio acceptance, no-hedge suppression, and ratio bound validation.
      - updated `README_FOR_SHARING.md` and `SKILL.md` examples/contracts for hedge controls.
      - validated with full gate: `npm run test` (build + unit + cli + smoke).
    - Release on 2026-02-26:
      - bumped version `1.1.4 -> 1.1.5`.
      - validation: unit + cli passed during `npm run test`; smoke had one transient timeout then passed on immediate rerun.
      - published `pandora-cli-skills@1.1.5` and verified `dist-tag latest=1.1.5`.
    - Mirror follow-up fixes (2026-02-26):
      - fixed hedge side code smell (`const hedgeSide = 'buy'`).
      - made rebalance sizing pool-aware using reserve total * drift fraction, bounded by `--max-rebalance-usdc`.
      - added rebalance diagnostics (`rebalanceSizingBasis`, `rebalanceCandidateUsdc`) to mirror sync snapshots.
      - documented Polymarket live-hedge env vars in `mirror sync --help` (table/json), `scripts/.env.example`, `README_FOR_SHARING.md`, and `SKILL.md`.
      - added CLI integration coverage for mirror sync help env requirements and rebalance sizing assertions.
      - validated with full gate: `npm run test` (build + unit + cli + smoke) passed.
  - Now:
    - Mirror follow-up fixes are committed and pushed to `origin/main`.
  - Next:
    - Optional: bump patch version and publish npm for these follow-up fixes.

Open questions (UNCONFIRMED if needed):
- None.

Working set (files/ids/commands):
- Core:
  - `/Users/mac/Desktop/pandora-market-setup-shareable/cli/pandora.cjs`
  - `/Users/mac/Desktop/pandora-market-setup-shareable/cli/lib/mirror_service.cjs`
  - `/Users/mac/Desktop/pandora-market-setup-shareable/cli/lib/mirror_sizing_service.cjs`
  - `/Users/mac/Desktop/pandora-market-setup-shareable/cli/lib/mirror_verify_service.cjs`
  - `/Users/mac/Desktop/pandora-market-setup-shareable/cli/lib/mirror_sync_service.cjs`
  - `/Users/mac/Desktop/pandora-market-setup-shareable/cli/lib/mirror_state_store.cjs`
  - `/Users/mac/Desktop/pandora-market-setup-shareable/cli/lib/polymarket_trade_adapter.cjs`
  - `/Users/mac/Desktop/pandora-market-setup-shareable/cli/lib/pandora_deploy_service.cjs`
- Tests/docs:
  - `/Users/mac/Desktop/pandora-market-setup-shareable/tests/unit/new-features.test.cjs`
  - `/Users/mac/Desktop/pandora-market-setup-shareable/tests/cli/cli.integration.test.cjs`
  - `/Users/mac/Desktop/pandora-market-setup-shareable/tests/smoke/pack-install-smoke.cjs`
  - `/Users/mac/Desktop/pandora-market-setup-shareable/README_FOR_SHARING.md`
  - `/Users/mac/Desktop/pandora-market-setup-shareable/SKILL.md`
 - Release ops:
  - `npm whoami` (failed with `E401` on 2026-02-26)
  - `npm version patch --no-git-tag-version` (`v1.1.4`)
  - `npm run test` (passed on `1.1.4`)
  - `npm publish --access public` (published `1.1.4`)
  - `npm view pandora-cli-skills dist-tags` (`latest: 1.1.4`)
  - `npm version patch --no-git-tag-version` (`v1.1.5`)
  - `npm run test` (unit + cli passed; smoke timeout once then passed on retry)
  - `npm publish --access public` (published `1.1.5`)
  - `npm view pandora-cli-skills dist-tags` (`latest: 1.1.5`)
 - Current task:
  - Completed: review-fix patch pushed (`f5ef5b7`).
